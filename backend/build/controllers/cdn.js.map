{"version":3,"file":"cdn.js","sourceRoot":"","sources":["../../src/controllers/cdn.ts"],"names":[],"mappings":";;;;AAAA,+BAA4B;AAC5B,2BAAgC;AAChC,0DAA0B;AAC1B,kDAAoD;AAIpD,SAAgB,WAAW,CAAC,CAAM,EAAE,GAAY,EAAE,GAAa;IAC7D,mEAAmE;IACnE,IAAI,CAAC,GAAG,CAAC,KAAK,IAAI,CAAC,CAAC,MAAM,IAAI,GAAG,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,IAAI,EAAE,MAAM,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE;QACzF,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,IAAA,iBAAK,EAAC,mBAAmB,CAAC,CAAC,CAAC;QACjD,OAAO;KACR;IAED,MAAM,IAAI,GAAG,GAAG,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC;IACxC,IAAI,CAAC,IAAI,EAAE;QACT,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,IAAA,iBAAK,EAAC,mBAAmB,CAAC,CAAC,CAAC;QACjD,OAAO;KACR;IACD,MAAM,IAAI,GAAG,IAAA,WAAI,EAAC,SAAS,EAAE,+BAA+B,IAAI,EAAE,CAAC,CAAC;IAEpE,IAAI,IAAA,eAAU,EAAC,IAAI,CAAC,EAAE;QACpB,IAAA,eAAK,EAAC,IAAI,CAAC;aACR,MAAM,CAAC,IAAA,WAAI,EAAC,SAAS,EAAE,6BAA6B,IAAI,OAAO,CAAC,CAAC;aACjE,IAAI,CAAC,GAAG,EAAE;YACT,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,IAAA,mBAAO,EAAC,iBAAiB,IAAI,OAAO,CAAC,CAAC,CAAC;QAC9D,CAAC,CAAC;aACD,KAAK,CAAC,CAAC,CAAC,EAAE;YACT,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC;gBACnB,OAAO,EAAE,KAAK;gBACd,OAAO,EAAE,uBAAuB;aACjC,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;KACN;;QAAM,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,IAAA,iBAAK,EAAC,iBAAiB,CAAC,CAAC,CAAC;AACxD,CAAC;AA3BD,kCA2BC","sourcesContent":["import { join } from 'path';\nimport { existsSync } from 'fs';\nimport sharp from 'sharp';\nimport { error, success } from '../utils/functions';\nimport type { Request, Response } from 'express';\nimport type { App } from '../app';\n\nexport function uploadImage(_: App, req: Request, res: Response): void {\n  // TEST IF req.files and req.files.file and req.files.file[0] exist\n  if (!req.files || !('file' in req.files) || !req.files.file?.length || !req.files.file[0]) {\n    res.status(400).json(error('No file provided.'));\n    return;\n  }\n\n  const file = req.files.file[0].filename;\n  if (!file) {\n    res.status(400).json(error('No file provided.'));\n    return;\n  }\n  const path = join(__dirname, `../../public/uploads/images/${file}`);\n\n  if (existsSync(path)) {\n    sharp(path)\n      .toFile(join(__dirname, `../../public/uploads/webp/${file}.webp`))\n      .then(() => {\n        res.status(200).json(success(`/uploads/webp/${file}.webp`));\n      })\n      .catch(_ => {\n        res.status(500).json({\n          success: false,\n          message: 'Error uploading image',\n        });\n      });\n  } else res.status(404).json(error('File not found.'));\n}\n"]}